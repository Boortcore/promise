!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).CustomPromise=t()}(this,(function(){"use strict";var n,t,e,r,i,o,u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(n){return n&&n.t&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function c(){if(r)return e;r=1;const{i:i,o:o,u:u}=t?n:(t=1,n={i:"All promises were rejected",o:"The method of Promise requires an array",u:{l:"fulfilled",h:"rejected",p:"pending"}});function f(n){return n instanceof l}function c(n){return n&&n.constructor===Array}function s(n){this.name="AggregateError",this.message=n||""}s.prototype=Object.create(Error.prototype),s.prototype.constructor=s;var a=globalThis.setImmediate||setTimeout;function l(n){this.state=u.p,this.v=this.v.bind(this),this.T=this.T.bind(this),this.j=!1,this.m=[];try{n(this.v,this.T)}catch(n){this.T(n)}}var d=l,h=d.prototype;return h.R=function(n){this.m.push(n)},h.M=function(){const n=this;if(n.state!==u.p){n.state!==u.h||n.j||a((function(){if(!n.j)throw n.value}));var t=n.m;n.m=[],a((function(){t.forEach((function(t){return n.state===u.l?t.P(n.value):t.q(n.value)}))}))}},h.A=function(n,t){const e=this;e.state===u.p&&(f(t)?t.then(e.v,e.T):(e.state=n,e.value=t,e.M()))},h.v=function(n){this.A(u.l,n)},h.T=function(n){this.A(u.h,n)},h.then=function(n,t){n="function"==typeof n?n:function(n){return n},t="function"==typeof t?t:function(n){throw n};var e=this;return e.j=!0,new d((function(r,i){e.R({P:function(t){try{r(n(t))}catch(n){i(n)}},q:function(n){try{r(t(n))}catch(n){i(n)}}}),e.M()}))},h.catch=function(n){return this.then(0,n)},h.finally=function(n){var t=function(t,e){return d.resolve(n()).then((function(){return e?d.reject(t):t}))};return this.then((function(n){return t(n)}),(function(n){return t(n,!0)}))},d.resolve=function(n){return f(n)?n:new d((function(t){t(n)}))},d.reject=function(n){return new d((function(t,e){e(n)}))},d.all=function(n){return new d((function(t,e){if(!c(n))return e(new TypeError(o));if(!n.length)return t([]);var r=0,i=[];n.forEach((function(o,u){o.then((function(e){i[u]=e,++r===n.length&&t(i)})).catch(e)}))}))},d.any=function(n){return new d((function(t,e){if(!c(n))return e(new TypeError(o));if(!n.length)return e(new s(i));var r=0;n.forEach((function(o){d.resolve(o).then((function(n){t(n)})).catch((function(){++r===n.length&&e(new s(i))}))}))}))},d.race=function(n){return new d((function(t,e){if(!c(n))return e(new TypeError(o));n.forEach((function(n){d.resolve(n).then(t).catch(e)}))}))},d.allSettled=function(n){return c(n)?d.all(n.map((function(n){return d.resolve(n).then((function(n){return{status:u.l,value:n}})).catch((function(n){return{status:u.h,reason:n}}))}))):d.reject(new TypeError(o))},d.try=function(n){return new d((function(t){t(n)}))},d.withResolvers=function(){let n,t;return{promise:new l(((e,r)=>{n=e,t=r})),resolve:n,reject:t}},e=l}return f(function(){if(o)return i;o=1;const n=c();var t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==u)return u;throw new Error("unable to locate global object")}();return"function"!=typeof t.Promise?t.Promise=n:(t.Promise.prototype.finally||(t.Promise.prototype.finally=n.finally),t.Promise.allSettled||(t.Promise.allSettled=n.allSettled),t.Promise.any||(t.Promise.any=n.any)),i=n}())}));
